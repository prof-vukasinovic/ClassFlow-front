<button routerLink="/classrooms">
  â† Retour aux classes
</button>

<h1 *ngIf="classroom">
  {{ classroom.nom }}
</h1>

<h2>Plan de classe</h2>

<button
  [routerLink]="['/classrooms', classroom?.id, 'groupes']"
  style="margin-bottom:15px;">
  ğŸ‘¥ Groupes d'Ã©lÃ¨ves
</button>

<div class="mode-selector">

  <button
    class="lock-toggle"
    [class.locked]="interactionMode === 'student'"
    [class.unlocked]="interactionMode === 'table'"
    (click)="toggleLock()">

    {{ interactionMode === 'student'
        ? 'ğŸ”’ Tables verrouillÃ©es'
        : 'ğŸ”“ Tables dÃ©verrouillÃ©es' }}

  </button>

  <div
    class="table-modes"
    *ngIf="interactionMode === 'table'">

    <button
      [class.active]="tableEditMode === 'free'"
      (click)="setTableMode('free')">
      Libre
    </button>

    <button
      [class.active]="tableEditMode === 'grid'"
      (click)="setTableMode('grid')">
      Grille
    </button>

    <button (click)="startAddingTable()" style="margin-left:10px;">
      â• Ajouter une table
    </button>

    <div *ngIf="tableEditMode === 'grid'" style="margin-top:10px">

      <label>
        Colonnes :
        <input type="number" [(ngModel)]="cols" min="1" style="width:60px">
      </label>

      <label style="margin-left:10px">
        Lignes :
        <input type="number" [(ngModel)]="rows" min="1" style="width:60px">
      </label>

      <button style="margin-left:10px" (click)="applyGrid()">
        âœ”ï¸
      </button>

    </div>

    <div *ngIf="tableEditMode === 'free'" style="margin-top:10px">

      <label>
        Taille table :
        <input type="number" [(ngModel)]="tableSize" min="50" style="width:80px">
      </label>

    </div>

  </div>

</div>

<div class="layout" *ngIf="classroom?.uiTables">

  <div class="plan-column">

    <app-plan
      [tables]="classroom.uiTables"
      [interactionMode]="interactionMode"
      [tableEditMode]="tableEditMode"
      [tableSize]="tableSize"
      (studentClicked)="selectStudent($event)"
      (tableDelete)="deleteTable($event)"
      (tableMoved)="saveClassroom()">
    </app-plan>

  </div>

  <div class="right-column" *ngIf="interactionMode === 'student'">

    <app-sidebar
      #sidebar
      [tables]="classroom.uiTables"
      [disabled]="interactionMode !== 'student'"
      (studentSelected)="selectStudent($event)"
      (addStudent)="openAddStudent($event)">
    </app-sidebar>

    <app-student-detail
      *ngIf="selectedStudent"
      [student]="selectedStudent"
      [classRoomId]="classroom?.id"
      (studentDeleted)="onStudentDeleted($event)"
      (remarksChanged)="onRemarksChanged()">
    </app-student-detail>

    <div class="remarque-filter">

      <h3>Filtrer par remarque</h3>

      <input
        type="text"
        [(ngModel)]="remarqueFilter"
        placeholder="ex: DM3 non fait">

      <div
        class="results-box"
        *ngIf="remarqueFilter.trim()">

        <div *ngIf="filteredResults.length === 0" class="no-result">
          Aucun rÃ©sultat
        </div>

        <div
          class="result-item"
          *ngFor="let result of filteredResults">

          <div class="result-student">
            {{ result.eleve.prenom }} {{ result.eleve.nom }}
          </div>

          <ul>
            <li *ngFor="let r of result.remarques">
              {{ r.intitule }} â€”
              {{ r.createdAt | date:'dd/MM/yyyy HH:mm' }}
            </li>
          </ul>

        </div>

      </div>

    </div>

  </div>

</div>