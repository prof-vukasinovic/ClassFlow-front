<div class="top-bar">

  <div class="left-section">

    <button routerLink="/classrooms" class="back-btn">
      â† Retour
    </button>

    <div class="titles">
      <h2 *ngIf="classroom">Classe de {{ classroom.nom }}</h2>
    </div>

    <div class="course-nav">
      <button (click)="prevCourse()">â¬…ï¸</button>
      <h2>Cours du {{ courseDate | date:'dd/MM/yyyy' }}</h2>
      <button (click)="nextCourse()">â¡ï¸</button>
    </div>

  </div>

  <div class="actions">

    <button [routerLink]="['/classrooms', classroom?.id, 'groupes']">
      ğŸ‘¥ Groupes
    </button>

    <button [routerLink]="['/classrooms', classroom?.id, 'roulette']">
      ğŸ¡ Tirage
    </button>

    <button [routerLink]="['/classrooms', classroom?.id, 'zone']">
      ğŸš¦ Zone
    </button>

    <button (click)="toggleSidebar()">
      {{ sidebarVisible ? 'ğŸ™ˆ Masquer infos Ã©lÃ¨ves' : 'ğŸ‘ï¸ Afficher infos Ã©lÃ¨ves' }}
    </button>

  </div>

</div>

<div class="mode-selector">

  <button
    class="lock-toggle"
    [class.locked]="interactionMode === 'student'"
    [class.unlocked]="interactionMode === 'table'"
    (click)="toggleLock()">

    {{ interactionMode === 'student'
        ? 'ğŸ”’ Tables verrouillÃ©es'
        : 'ğŸ”“ Tables dÃ©verrouillÃ©es' }}

  </button>

  <div
    class="table-modes"
    *ngIf="interactionMode === 'table'">

    <label>
      Colonnes :
      <input type="number"
             [(ngModel)]="tempCols"
             min="1"
             style="width:60px">
    </label>

    <label style="margin-left:10px">
      Lignes :
      <input type="number"
             [(ngModel)]="tempRows"
             min="1"
             style="width:60px">
    </label>

    <button style="margin-left:10px" (click)="applyGrid()">
      âœ”ï¸
    </button>

  </div>

</div>

<div class="layout" *ngIf="classroom?.uiTables">

  <div class="plan-column">

    <app-plan
      [tables]="classroom.uiTables"
      [interactionMode]="interactionMode"
      [tableSize]="tableSize"
      [cols]="cols"
      [rows]="rows"
      (studentClicked)="selectStudent($event)"
      (tableMoved)="saveClassroom()"
      (studentsSwapped)="onStudentsSwapped($event)">
    </app-plan>

  </div>

  <div class="right-column" *ngIf="sidebarVisible">

    <app-sidebar
      #sidebar
      [tables]="classroom.uiTables"
      [disabled]="interactionMode !== 'student'"
      (studentSelected)="selectStudent($event)"
      (addStudent)="openAddStudent($event)">
    </app-sidebar>

    <app-student-detail
      *ngIf="selectedStudent"
      [student]="selectedStudent"
      [classRoomId]="classroom?.id"
      [courseDate]="courseDate"
      (studentDeleted)="onStudentDeleted($event)"
      (remarksChanged)="onRemarksChanged()">
    </app-student-detail>

    <div class="remarque-filter">

      <h3>Filtrer par remarque</h3>

      <input
        type="text"
        [(ngModel)]="remarqueFilter"
        placeholder="ex: DM3 non fait">

      <div
        class="results-box"
        *ngIf="remarqueFilter.trim()">

        <div *ngIf="filteredResults.length === 0" class="no-result">
          Aucun rÃ©sultat
        </div>

        <div
          class="result-item"
          *ngFor="let result of filteredResults">

          <div class="result-student">
            {{ result.eleve.prenom }} {{ result.eleve.nom }}
          </div>

          <ul>
            <li *ngFor="let r of result.remarques">
              {{ r.intitule }} â€”
              {{ r.createdAt | date:'dd/MM/yyyy HH:mm' }}
            </li>
          </ul>

        </div>

      </div>

    </div>

  </div>

</div>